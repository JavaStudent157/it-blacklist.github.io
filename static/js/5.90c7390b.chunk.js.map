{"version":3,"sources":["pages/content/index.module.less","pages/content/index.tsx"],"names":["module","exports","Content","state","useContext","GlobalState","location","useLocation","navigate","useNavigate","useState","detail","setDetail","discussList","setDiscussList","submitLoading","setSubmitLoading","checked","setChecked","getDiscussList","company","getDiscussApi","current","pageSize","then","res","console","log","getList","needDiscuss","params","qs","parse","search","getListApi","useEffect","updateRate","type","updateListApi","_id","rate","userInfo","Toast","show","className","styles","page_content","onBack","title","extra","dayjs","createTime","format","bodyStyle","fontSize","paddingBottom","content","color","fill","style","float","onClick","Modal","confirm","onConfirm","btn_wrap","openid","rateUp","filter","item","rateDown","isRate","findIndex","size","shape","padding","paddingRight","length","rateConfig","discuss_title","map","Item","marginTop","layout","footer","onChange","val","marginBottom","to","block","loading","onFinish","values","updateDiscussApi","errcode","Dialog","alert","finally","name","rules","required","message","placeholder","maxLength","rows"],"mappings":"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","file":"static/js/5.90c7390b.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"page_content\":\"page_content_N+OYe\",\"btn_wrap\":\"btn_wrap_BY6xg\",\"discuss_title\":\"discuss_title_JMxc9\"};","import React, { useContext, useEffect, useState } from 'react'\nimport {\n  Card,\n  NavBar,\n  Button,\n  List,\n  Toast,\n  Dialog,\n  Modal,\n  Checkbox, Form, TextArea,\n} from 'antd-mobile'\nimport { MessageFill, SmileFill, FrownFill } from 'antd-mobile-icons'\nimport { Link, useLocation, useNavigate } from 'react-router-dom'\nimport qs from 'query-string'\nimport {\n  getListApi,\n  getDiscussApi,\n  updateDiscussApi,\n  updateListApi\n} from '../../services/api'\nimport styles from './index.module.less'\nimport dayjs from 'dayjs'\nimport { GlobalState } from '../../store'\n\nconst Content: React.FC = () => {\n  const { state } = useContext<any>(GlobalState)\n  const location = useLocation()\n  const navigate = useNavigate()\n  const [detail, setDetail] = useState<any>({})\n  const [discussList, setDiscussList] = useState([])\n  const [submitLoading, setSubmitLoading] = useState(false)\n  const [checked, setChecked] = useState(false)\n  const getDiscussList = (company: string) => {\n    getDiscussApi({\n      company,\n      current: 1,\n      pageSize: 100,\n    }).then((res: any) => {\n      setDiscussList(res)\n      console.log(res)\n    })\n  }\n  const handleSubmit = (params: any) => {\n    if (!checked) {\n      Dialog.alert({\n        content: '请先勾选协议',\n        onConfirm: () => {},\n      })\n      return\n    }\n    Modal.confirm({\n      content: '确认要提交吗？',\n      onConfirm: () => {\n        setSubmitLoading(true)\n        updateDiscussApi({\n          ...params,\n          userInfo: state.userInfo,\n          company: detail.company,\n        }).then((res) => {\n          console.log(res)\n          //@ts-ignore\n          if (res?.errcode) {\n            Dialog.alert({\n              content: '内容可能含有违法违规内容',\n              onConfirm: () => {},\n            })\n          } else {\n            Dialog.alert({\n              content: '保存成功',\n              onConfirm: () => {\n                getDiscussList(detail.company)\n              },\n            })\n          }\n        }).finally(() => {\n          setSubmitLoading(false)\n        })\n      },\n    })\n  }\n  const getList = (needDiscuss?: boolean) => {\n    const params = qs.parse(location.search) as { _id: string }\n    getListApi(params).then((res: any) => {\n      setDetail(res[0])\n      if(needDiscuss){\n        getDiscussList(res[0].company)\n      }\n    })\n  }\n  useEffect(() => {\n    getList(true)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n  const back = () => {\n    navigate('/')\n  }\n  const appeal = () => {\n    Modal.confirm({\n      content: '如果内容有误，可以点此纠错，请具体到哪家公司、哪条评论',\n      onConfirm: () => {\n        navigate(`/feedback?_id=${detail._id}&company=${detail.company}`)\n      },\n    })\n  }\n  const updateRate = (type: number) => {\n    updateListApi({\n      _id: detail._id,\n      rate: {\n        type,\n        userInfo: state.userInfo\n      }\n    }).then(()=>{\n      getList()\n      Toast.show('评价成功')\n    })\n  }\n  const rateConfig = () => {\n    const openid = state.userInfo.openid || ''\n    const rate = detail.rate || []\n    const rateUp = rate.filter((item: any) => item.type === 1)\n    const rateDown = rate.filter((item: any) => item.type === -1)\n    const isRate = [...rateUp, ...rateDown].findIndex(\n      item => item.userInfo.openid === openid) !== -1\n    return <>\n      <Button onClick={() => updateRate(isRate ? 0 : 1)} size=\"small\"\n              color={isRate ? 'success' : 'default'} shape=\"rounded\">\n        {isRate ? <div style={{padding:'0 6px'}}><SmileFill style={{paddingRight: 4}}/>{rateUp.length}</div> : '有价值'}\n      </Button>\n      <Button onClick={() => updateRate(isRate ? 0 : -1)} size=\"small\"\n              color={isRate ? 'danger' : 'default'} shape=\"rounded\">\n        {isRate ? <div style={{padding:'0 6px'}}><FrownFill style={{paddingRight: 4}}/>{rateDown.length}</div> : '无价值'}\n      </Button>\n    </>\n  }\n  return <div className={styles.page_content}>\n    <NavBar onBack={back}/>\n    <Card title={detail.company}\n          extra={`${dayjs(detail.createTime).format('YYYY-MM-DD HH:mm')}`}\n          bodyStyle={{ fontSize: 18, paddingBottom: 40 }}>\n      {detail.content}\n      <Button color=\"primary\" fill=\"none\" style={{ float: 'right' }}\n              onClick={() => appeal()}>\n        我要纠错\n      </Button>\n    </Card>\n    <div className={styles.btn_wrap}>\n      {rateConfig()}\n    </div>\n    <div className={styles.discuss_title}><MessageFill/>精选评论</div>\n    <List>\n      {discussList.map((item: any) => <List.Item key={item._id}>\n        <div onClick={() => Toast.show(`发表时间:${dayjs(item.createTime).\n          format('YYYY-MM-DD HH:mm:ss')}`)}>{item.content}</div>\n      </List.Item>)}\n    </List>\n    <Form\n      style={{ marginTop: 20 }}\n      layout=\"horizontal\"\n      footer={\n        <>\n          <Checkbox\n            checked={checked}\n            onChange={(val) => setChecked(val)}\n            style={{\n              '--icon-size': '18px',\n              '--font-size': '14px',\n              '--gap': '6px',\n              marginBottom: 8,\n            }}\n          >\n            勾选代表已阅读并同意<Link to=\"/statement\">相关条款</Link>\n          </Checkbox>\n          <Button block type=\"submit\" color=\"primary\" loading={submitLoading}>\n            提交\n          </Button>\n        </>\n      }\n      onFinish={(values) => {\n        handleSubmit(values)\n      }}\n    >\n      <Form.Item name=\"content\" rules={[{ required: true, message: '内容不能为空' }]}>\n        <TextArea placeholder=\"我要评论…\" maxLength={2000} rows={4}/>\n      </Form.Item>\n    </Form>\n\n  </div>\n}\n\nexport default Content"],"sourceRoot":""}